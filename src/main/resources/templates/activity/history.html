<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My activity</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet"/>
    <link th:href="@{/styles/main.css}" rel="stylesheet"/>
    <link th:href="@{/styles/navbar.css}" rel="stylesheet"/>
    <style>
        :root {
            --primary-color: #22B14C;
            --secondary-color: #f8f9fc;
            --accent-color: #1a8c3b;
            --text-color: #333333;
            --light-gray: #e9f5ee;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .page-header {
            position: relative;
            background-color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 0.5rem 0 rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-color);
        }

        .page-header h1 {
            font-weight: 600;
            color: #333;
            margin: 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }

        .card {
            border: none;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 0.5rem 0 rgba(0, 0, 0, 0.05);
        }

        .card-header {
            background-color: white;
            border-bottom: 1px solid var(--light-gray);
            padding: 0.75rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h5 {
            color: var(--primary-color);
            font-weight: 600;
            margin: 0;
        }

        .table {
            margin-bottom: 0;
        }

        .table thead th {
            background-color: var(--secondary-color);
            border-bottom: none;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            padding: 1rem;
        }

        .table tbody td {
            padding: 1rem;
            vertical-align: middle;
        }

        .badge-activity {
            font-size: 0.75rem;
            padding: 0.35em 0.65em;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        .bg-task-created {
            background-color: #17a2b8;
            color: white;
        }

        .bg-task-completed {
            background-color: #28a745;
            color: white;
        }

        .bg-advice-created {
            background-color: #007bff;
            color: white;
        }

        .bg-article-created {
            background-color: #6f42c1;
            color: white;
        }

        .pagination .page-link {
            color: var(--primary-color);
            border: none;
            margin: 0 0.15rem;
            border-radius: 0.25rem;
            padding: 0.375rem 0.75rem;
        }

        .pagination .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            opacity: 0.6;
        }

        .filter-form {
            background-color: white;
            border-radius: 0.35rem;
            padding: 1rem;
            box-shadow: 0 0.15rem 0.5rem 0 rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }

        .form-select {
            border-radius: 0.25rem;
            border-color: var(--light-gray);
            padding: 0.375rem 0.75rem;
        }

        .btn-filter {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            padding: 0.375rem 0.75rem;
            font-weight: 400;
        }

        .btn-filter:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .details-list {
            list-style-type: none;
            padding-left: 0;
            margin-bottom: 0;
        }

        .details-list li {
            padding: 0.2rem 0;
            line-height: 1.4;
        }

        .details-item-key {
            font-weight: 500;
            color: #555;
        }

        .details-item-value {
            color: #333;
        }

        .empty-state {
            padding: 2rem;
            text-align: center;
            color: #777;
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #ccc;
        }

        tr:hover {
            background-color: var(--light-gray);
        }
    </style>
    <script src="/scripts/navbar.js" defer></script>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container py-4">
    <div class="page-header">
        <h1><i class="bi bi-activity me-2"></i>My activity</h1>
    </div>

    <!-- Filtr aktywności -->
    <div class="filter-form">
        <form class="row g-2" th:action="@{${baseUrl}}" method="get">
            <div class="col-md-4">
                <label for="activityFilter" class="form-label">Filter by activity type</label>
                <div class="input-group">
                    <select id="activityFilter" name="filter" class="form-select">
                        <option value="" th:selected="${filter == null}">All types</option>
                        <option th:each="type : ${activityTypes}"
                                th:value="${type}"
                                th:text="${type}"
                                th:selected="${type == filter}">
                        </option>
                    </select>
                    <button type="submit" class="btn btn-filter">
                        <i class="bi bi-funnel-fill me-1"></i> Apply
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Activity log</h5>

            <!-- Paginacja u góry -->
            <nav aria-label="Activity pagination top">
                <ul class="pagination mb-0">
                    <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{${baseUrl}(page=${currentPage - 2}, size=${size}, filter=${filter})}"
                           aria-label="Previous">
                            <span aria-hidden="true"><i class="bi bi-chevron-left"></i></span>
                        </a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                        th:classappend="${i == currentPage} ? 'active'">
                        <a class="page-link"
                           th:href="@{${baseUrl}(page=${i - 1}, size=${size}, filter=${filter})}"
                           th:text="${i}"></a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{${baseUrl}(page=${currentPage}, size=${size}, filter=${filter})}"
                           aria-label="Next">
                            <span aria-hidden="true"><i class="bi bi-chevron-right"></i></span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="table-responsive">
            <table class="table">
                <thead class="table-light">
                <tr>
                    <th><i class="bi bi-calendar-event me-1"></i> Date and time</th>
                    <th><i class="bi bi-tag me-1"></i> Activity type</th>
                    <th><i class="bi bi-info-circle me-1"></i> Details</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="log : ${logsPage.content}">
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="d-inline-block me-3 text-center">
                                <div class="small text-muted" th:text="${#temporals.format(log.occurredAt, 'dd MMM')}">13 May</div>
                                <div class="small fw-bold" th:text="${#temporals.format(log.occurredAt, 'HH:mm')}">14:22</div>
                            </div>
                            <div class="text-dark" th:text="${#temporals.format(log.occurredAt, 'yyyy-MM-dd HH:mm')}">
                                2025-05-13 14:22
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge badge-activity"
                              th:classappend="${
                                log.activityType == 'TASK_CREATED' ? 'bg-task-created' :
                                log.activityType == 'TASK_COMPLETED' ? 'bg-task-completed' :
                                log.activityType == 'ADVICE_CREATED' ? 'bg-advice-created' :
                                log.activityType == 'ARTICLE_CREATED' ? 'bg-article-created' :
                                'bg-secondary'
                              }"
                              th:text="${log.activityType}">TYPE</span>
                    </td>
                    <td>
                        <ul class="details-list">
                            <li th:each="entry : ${log.details.entrySet()}">
                                <span class="details-item-key" th:text="${entry.key}">key</span>:
                                <span class="details-item-value" th:text="${entry.value}">value</span>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr th:if="${logsPage.totalElements == 0}">
                    <td colspan="3" class="empty-state">
                        <i class="bi bi-clipboard-x text-muted"></i>
                        <p>Brak zapisów aktywności.</p>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="card-footer bg-white">
            <!-- Paginacja na dole -->
            <nav aria-label="Activity pagination bottom">
                <ul class="pagination justify-content-center mb-0">
                    <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{${baseUrl}(page=${currentPage - 2}, size=${size}, filter=${filter})}"
                           aria-label="Previous">
                            <span aria-hidden="true"><i class="bi bi-chevron-left"></i></span>
                        </a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                        th:classappend="${i == currentPage} ? 'active'">
                        <a class="page-link"
                           th:href="@{${baseUrl}(page=${i - 1}, size=${size}, filter=${filter})}"
                           th:text="${i}"></a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{${baseUrl}(page=${currentPage}, size=${size}, filter=${filter})}"
                           aria-label="Next">
                            <span aria-hidden="true"><i class="bi bi-chevron-right"></i></span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
